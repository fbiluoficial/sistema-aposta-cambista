<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Apostas Cambista</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Apostas Cambista">
    <meta name="theme-color" content="#10B981"> <link rel="icon" href="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR50cnHL0CpFJlbJNM9-7OrHTTOQvqk-s_MLw&usqp=CAU">
    <link rel="apple-touch-icon" href="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR50cnHL0CpFJlbJNM9-7OrHTTOQvqk-s_MLw&usqp=CAU">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Estilos para rolagem suave do filtro */
        .overflow-x-auto::-webkit-scrollbar {
            height: 4px;
        }
        .overflow-x-auto::-webkit-scrollbar-thumb {
            background-color: rgba(0,0,0,0.2);
            border-radius: 10px;
        }
        .overflow-x-auto::-webkit-scrollbar-track {
            background-color: rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-50 to-green-50">

    <div id="app-root">
        </div>

    <script>
        // Variáveis de estado globais
        let apostas = [];
        let clientes = [];
        let showAddAposta = false;
        let showPagamentoAposta = null;
        let showPagamentoCliente = null;
        let activeTab = 'home';
        let filtroData = 'pendentes'; // Padrão "pendentes"
        let clienteSelecionado = null;
        let showAddCliente = false;
        let novoClienteNome = '';
        let showConfirmDeleteBet = null;
        let showConfirmDeleteClient = null;
        let showEditAposta = false;
        let apostaEmEdicao = null;

        let novaAposta = {
            clienteId: '',
            valor: '',
            data: new Date().toISOString().split('T')[0]
        };

        let pagamentoAposta = {
            valor: '',
            tipo: 'parcial'
        };

        let pagamentoCliente = {
            valor: '',
            tipo: 'parcial'
        };

        // --- Funções Utilitárias ---
        function formatCurrency(amount) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL',
            }).format(amount);
        }

        function formatDate(dateString) {
            if (!dateString) return '';
            return new Date(dateString).toLocaleDateString('pt-BR');
        }

        function getClienteById(id) {
            return clientes.find(c => c.id === id);
        }

        // Função para calcular o total pendente de um cliente
        function getDividaPendenteCliente(clienteId) {
            return apostas
                .filter(aposta => aposta.clienteId === clienteId && !aposta.paga)
                .reduce((sum, aposta) => sum + (aposta.valor - (aposta.valorPago || 0)), 0);
        }

        // --- Persistência de Dados ---
        function salvarDados() {
            const dados = {
                apostas,
                clientes,
                ultimaAtualizacao: new Date().toISOString(),
                versao: '5.0'
            };
            localStorage.setItem('cambistaAppData', JSON.stringify(dados));
        }

        function carregarDados() {
            try {
                const dadosSalvos = localStorage.getItem('cambistaAppData');
                if (dadosSalvos) {
                    const dados = JSON.parse(dadosSalvos);
                    apostas = dados.apostas || [];
                    clientes = dados.clientes || [];
                }
            } catch (error) {
                console.error("Erro ao carregar dados do localStorage:", error);
                localStorage.removeItem('cambistaAppData');
            }
        }

        function exportarDados() {
            const dados = {
                apostas,
                clientes,
                resumo: {
                    totalApostas: apostas.length,
                    valorTotal: apostas.reduce((sum, a) => sum + parseFloat(a.valor || 0), 0),
                    valorPago: apostas.reduce((sum, a) => sum + parseFloat(a.valorPago || 0), 0),
                    dataExportacao: new Date().toISOString()
                }
            };
            
            const dataStr = JSON.stringify(dados, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `apostas-e-clientes-backup-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }

        function importarDados(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const dados = JSON.parse(e.target.result);
                        if (dados.apostas && dados.clientes) {
                            apostas = dados.apostas;
                            clientes = dados.clientes;
                            alert('Dados importados com sucesso!');
                            salvarDados(); // Salva os dados importados
                            renderApp();
                        } else {
                            alert('Arquivo JSON inválido ou incompleto.');
                        }
                    } catch (error) {
                        alert('Erro ao importar dados. Verifique o arquivo.');
                        console.error("Erro ao parsear JSON importado:", error);
                    }
                };
                reader.readAsText(file);
            }
        }

        // --- Lógica de Negócio ---
        function adicionarAposta() {
            if (!novaAposta.clienteId || !novaAposta.valor) return;

            const clienteExistente = clientes.find(c => c.id === novaAposta.clienteId);
            if (!clienteExistente) {
                alert('Cliente não encontrado.');
                return;
            }

            const valorApostaNumerico = parseFloat(novaAposta.valor);

            const apostaExistenteIndex = apostas.findIndex(a => 
                a.clienteId === novaAposta.clienteId && 
                a.data === novaAposta.data && 
                !a.paga
            );

            if (apostaExistenteIndex !== -1) {
                apostas = apostas.map((aposta, index) => {
                    if (index === apostaExistenteIndex) {
                        return {
                            ...aposta,
                            valor: aposta.valor + valorApostaNumerico
                        };
                    }
                    return aposta;
                });
            } else {
                const aposta = {
                    id: Date.now(),
                    clienteId: novaAposta.clienteId,
                    nome: clienteExistente.nome,
                    valor: valorApostaNumerico,
                    paga: false,
                    valorPago: 0,
                    dataPagamento: null,
                    pagamentos: [],
                    data: novaAposta.data
                };
                apostas = [aposta, ...apostas];
            }

            clientes = clientes.map(c => 
                c.id === novaAposta.clienteId ? { ...c, betCount: (c.betCount || 0) + 1, lastUsed: Date.now() } : c
            );

            novaAposta = {
                clienteId: '',
                valor: '',
                data: new Date().toISOString().split('T')[0]
            };
            showAddAposta = false;
            salvarDados(); // Salva após adicionar/atualizar aposta
            renderApp();
        }

        function marcarComoPaga(id) {
            const aposta = apostas.find(a => a.id === id);
            if (!aposta) return;

            apostas = apostas.map(a => 
                a.id === id ? { 
                    ...a, 
                    paga: true, 
                    valorPago: a.valor,
                    dataPagamento: new Date().toISOString(),
                    pagamentos: [...(a.pagamentos || []), {
                        valor: a.valor - (a.valorPago || 0),
                        data: new Date().toISOString(),
                        tipo: 'pagamento_total'
                    }]
                } : a
            );
            salvarDados(); // Salva após marcar como paga
            renderApp();
        }

        function adicionarPagamentoParcialAposta() {
            if (!pagamentoAposta.valor || !showPagamentoAposta) return;

            const valorPagamento = parseFloat(pagamentoAposta.valor);
            if (valorPagamento <= 0) return;

            apostas = apostas.map(aposta => {
                if (aposta.id === showPagamentoAposta) {
                    const novoValorPago = (aposta.valorPago || 0) + valorPagamento;
                    const novosPagamentos = [...(aposta.pagamentos || []), {
                        valor: valorPagamento,
                        data: new Date().toISOString(),
                        tipo: 'pagamento_parcial'
                    }];

                    return {
                        ...aposta,
                        valorPago: novoValorPago,
                        paga: novoValorPago >= aposta.valor,
                        dataPagamento: novoValorPago >= aposta.valor ? new Date().toISOString() : aposta.dataPagamento,
                        pagamentos: novosPagamentos
                    };
                }
                return aposta;
            });

            pagamentoAposta = { valor: '', tipo: 'parcial' };
            showPagamentoAposta = null;
            salvarDados(); // Salva após pagamento parcial
            renderApp();
        }

        function adicionarPagamentoCliente() {
            if (!pagamentoCliente.valor || !showPagamentoCliente) return;

            let valorRestantePagamento = parseFloat(pagamentoCliente.valor);
            if (valorRestantePagamento <= 0) return;

            apostas = apostas.map(aposta => {
                if (aposta.clienteId === showPagamentoCliente && !aposta.paga && valorRestantePagamento > 0) {
                    const dividaRestanteAposta = aposta.valor - (aposta.valorPago || 0);
                    const valorAPagarNestaAposta = Math.min(valorRestantePagamento, dividaRestanteAposta);

                    if (valorAPagarNestaAposta > 0) {
                        const novoValorPago = (aposta.valorPago || 0) + valorAPagarNestaAposta;
                        const novosPagamentos = [...(aposta.pagamentos || []), {
                            valor: valorAPagarNestaAposta,
                            data: new Date().toISOString(),
                            tipo: 'pagamento_cliente'
                        }];

                        valorRestantePagamento -= valorAPagarNestaAposta;

                        return {
                            ...aposta,
                            valorPago: novoValorPago,
                            paga: novoValorPago >= aposta.valor,
                            dataPagamento: novoValorPago >= aposta.valor ? new Date().toISOString() : aposta.dataPagamento,
                            pagamentos: novosPagamentos
                        };
                    }
                }
                return aposta;
            });

            pagamentoCliente = { valor: '', tipo: 'parcial' };
            showPagamentoCliente = null;
            salvarDados(); // Salva após pagamento do cliente
            renderApp();
        }

        function pagarDividaTotalCliente() {
            if (!showPagamentoCliente) return;

            apostas = apostas.map(aposta => {
                if (aposta.clienteId === showPagamentoCliente && !aposta.paga) {
                    const valorRestante = aposta.valor - (aposta.valorPago || 0);
                    return {
                        ...aposta,
                        paga: true,
                        valorPago: aposta.valor,
                        dataPagamento: new Date().toISOString(),
                        pagamentos: [...(aposta.pagamentos || []), {
                            valor: valorRestante,
                            data: new Date().toISOString(),
                            tipo: 'pagamento_total_cliente'
                        }]
                    };
                }
                return aposta;
            });
            showPagamentoCliente = null;
            salvarDados(); // Salva após pagar dívida total do cliente
            renderApp();
        }

        function adicionarCliente() {
            if (!novoClienteNome.trim()) return;

            const novoCliente = {
                id: Date.now().toString(),
                nome: novoClienteNome.trim(),
                favorito: false,
                betCount: 0,
                lastUsed: Date.now()
            };

            clientes = [...clientes, novoCliente];
            novoClienteNome = '';
            showAddCliente = false;
            salvarDados(); // Salva após adicionar cliente
            renderApp();
        }

        function toggleFavoritoCliente(id) {
            const clienteIndex = clientes.findIndex(c => c.id === id);
            if (clienteIndex === -1) return;

            const cliente = { ...clientes[clienteIndex] };
            const favoritosAtuais = clientes.filter(c => c.favorito).length;

            if (cliente.favorito) {
                cliente.favorito = false;
            } else {
                if (favoritosAtuais < 5) {
                    cliente.favorito = true;
                } else {
                    alert('Você pode fixar no máximo 5 clientes como favoritos.');
                    return;
                }
            }
            
            const newClientes = [...clientes];
            newClientes[clienteIndex] = cliente;
            clientes = newClientes;
            salvarDados(); // Salva após alterar favorito
            renderApp();
        }

        function handleDeleteBet(id) {
            apostas = apostas.filter(aposta => aposta.id !== id);
            showConfirmDeleteBet = null;
            salvarDados(); // Salva após deletar aposta
            renderApp();
        }

        function handleDeleteClient(id) {
            apostas = apostas.filter(aposta => aposta.clienteId !== id);
            clientes = clientes.filter(cliente => cliente.id !== id);
            showConfirmDeleteClient = null;
            clienteSelecionado = null;
            activeTab = 'clientes';
            salvarDados(); // Salva após deletar cliente
            renderApp();
        }

        function handleEditAposta(aposta) {
            apostaEmEdicao = { ...aposta };
            showEditAposta = true;
            renderApp();
        }

        function updateAposta() {
            if (!apostaEmEdicao || !apostaEmEdicao.valor || !apostaEmEdicao.clienteId) return;

            const clienteExistente = clientes.find(c => c.id === apostaEmEdicao.clienteId);
            if (!clienteExistente) {
                alert('Cliente não encontrado para a aposta editada.');
                return;
            }

            apostas = apostas.map(aposta => 
                aposta.id === apostaEmEdicao.id 
                    ? { 
                        ...apostaEmEdicao, 
                        valor: parseFloat(apostaEmEdicao.valor),
                        nome: clienteExistente.nome
                    } 
                    : aposta
            );
            apostaEmEdicao = null;
            showEditAposta = false;
            salvarDados(); // Salva após atualizar aposta
            renderApp();
        }

        // --- Funções de Renderização ---
        function getIconSVG(iconName, size = 20, className = '') {
            const icons = {
                Plus: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><path d="M12 5V19"></path><path d="M5 12H19"></path></svg>`,
                Download: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" x2="12" y1="15" y2="3"></line></svg>`,
                Upload: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" x2="12" y1="3" y2="15"></line></svg>`,
                Trophy: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path><path d="M4.5 22H20v-7.5a4.5 4.5 0 0 0-4.5-4.5H9A4.5 4.5 0 0 0 4.5 14.5z"></path><path d="M12 17v5"></path></svg>`,
                Target: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></svg>`,
                CheckCircle: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>`,
                Clock: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>`,
                BarChart3: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><path d="M12 20V10"></path><path d="M18 20V4"></path><path d="M6 20v-4"></path></svg>`,
                Home: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>`,
                PieChart: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><path d="M21.21 15.89A10 10 0 1 1 8 2.83"></path><path d="M22 12A10 10 0 0 0 12 2v10z"></path></svg>`,
                User: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>`,
                Settings: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.78 1.22a2 2 0 0 0 .73 2.73l.09.09a2 2 0 0 1 0 2.83l-.08.15a2 2 0 0 0-.73 2.73l1.22.78a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.78-1.22a2 2 0 0 0-.73-2.73l-.09-.09a2 2 0 0 1 0-2.83l.08-.15a2 2 0 0 0 .73-2.73l-1.22-.78a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg>`,
                Edit3: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><path d="M12 20h9"></path><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path></svg>`,
                Star: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>`,
                Trash2: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><path d="M3 6h18"></path><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path><line x1="10" x2="10" y1="11" y2="17"></line><line x1="14" x2="14" y1="11" y2="17"></line></svg>`,
                DollarSign: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${className}"><line x1="12" x2="12" y1="2" y2="22"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>`
            };
            return icons[iconName] || '';
        }

        function NavButton(tab, iconName, label, isActive) {
            const activeClass = isActive 
                ? 'bg-gradient-to-r from-green-500 to-emerald-600 text-white shadow-lg transform scale-105' 
                : 'text-gray-600 hover:bg-gray-100';
            return `
                <button
                    data-tab="${tab}"
                    class="flex flex-col items-center justify-center p-3 rounded-2xl transition-all duration-300 ${activeClass}"
                >
                    ${getIconSVG(iconName, 20)}
                    <span class="text-xs mt-1 font-medium">${label}</span>
                </button>
            `;
        }

        function ConfirmationModal(message, confirmAction, cancelAction) {
            return `
                <div class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4">
                    <div class="bg-white rounded-2xl p-6 shadow-xl w-full max-w-sm text-center">
                        <p class="text-lg font-semibold text-gray-800 mb-6">${message}</p>
                        <div class="flex justify-around gap-4">
                            <button
                                onclick="${cancelAction}"
                                class="flex-1 px-4 py-2 bg-gray-200 text-gray-800 rounded-xl font-medium hover:bg-gray-300 transition-colors"
                            >
                                Cancelar
                            </button>
                            <button
                                onclick="${confirmAction}"
                                class="flex-1 px-4 py-2 bg-red-500 text-white rounded-xl font-medium hover:bg-red-600 transition-colors"
                            >
                                Confirmar
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderApp() {
            const appRoot = document.getElementById('app-root');
            appRoot.innerHTML = ''; // Limpa o conteúdo anterior

            // Calcular totais filtrados (precisa ser refeito a cada render)
            const hoje = new Date();
            const ontem = new Date(hoje);
            ontem.setDate(hoje.getDate() - 1);
            
            const apostasFiltradas = apostas.filter(aposta => {
                const dataAposta = new Date(aposta.data);
                switch(filtroData) {
                    case 'hoje': return dataAposta.toDateString() === hoje.toDateString();
                    case 'ontem': return dataAposta.toDateString() === ontem.toDateString();
                    case 'semana':
                        const semanaAtras = new Date(hoje);
                        semanaAtras.setDate(hoje.getDate() - 7);
                        return dataAposta >= semanaAtras;
                    case 'mes': return dataAposta.getMonth() === hoje.getMonth() && dataAposta.getFullYear() === hoje.getFullYear();
                    case 'pendentes': return !aposta.paga;
                    case 'pagas': return aposta.paga;
                    case 'todos': return true;
                    default: return true;
                }
            });

            const totalApostasFiltradas = apostasFiltradas.reduce((sum, a) => sum + a.valor, 0);
            const totalPagoFiltradas = apostasFiltradas.reduce((sum, a) => sum + (a.valorPago || 0), 0);
            const totalPendenteFiltradas = totalApostasFiltradas - totalPagoFiltradas;

            // Ordenar clientes para dropdown e lista
            const favoritos = clientes.filter(c => c.favorito);
            const naoFavoritos = clientes.filter(c => !c.favorito);

            const sortedFavoritos = favoritos.sort((a, b) => {
                if (a.betCount !== b.betCount) {
                    return b.betCount - a.betCount;
                }
                return b.lastUsed - a.lastUsed;
            });

            const top2Favoritos = sortedFavoritos.slice(0, 2);
            const outrosFavoritos = sortedFavoritos.slice(2);

            const sortedNaoFavoritos = naoFavoritos.sort((a, b) => a.nome.localeCompare(b.nome));
            const sortedClientes = [...top2Favoritos, ...outrosFavoritos, ...sortedNaoFavoritos];

            // Render Header
            appRoot.innerHTML += `
                <div class="bg-gradient-to-r from-green-600 via-emerald-600 to-teal-600 text-white p-6 rounded-b-3xl shadow-2xl">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center gap-3">
                            <div class="p-3 bg-white/20 rounded-2xl backdrop-blur-sm">
                                ${getIconSVG('Trophy', 24)}
                            </div>
                            <div>
                                <h1 class="text-xl font-bold">Sistema de Apostas</h1>
                                <p class="text-green-100 text-sm">Controle de Pagamentos</p>
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <button
                                onclick="exportarDados()"
                                class="p-2 bg-white/20 rounded-xl backdrop-blur-sm hover:bg-white/30 transition-colors"
                                title="Exportar dados"
                            >
                                ${getIconSVG('Download', 20)}
                            </button>
                            <label class="p-2 bg-white/20 rounded-xl backdrop-blur-sm hover:bg-white/30 transition-colors cursor-pointer" title="Importar dados">
                                ${getIconSVG('Upload', 20)}
                                <input
                                    type="file"
                                    accept=".json"
                                    onchange="importarDados(event)"
                                    class="hidden"
                                />
                            </label>
                        </div>
                    </div>
                    ${activeTab === 'home' ? `
                        <div class="text-center py-4">
                            <p class="text-green-100 text-sm mb-1">Total Pendente</p>
                            <h2 class="text-3xl font-bold mb-2">${formatCurrency(totalPendenteFiltradas)}</h2>
                            <div class="flex justify-center gap-4 text-sm">
                                <div class="flex items-center gap-1">
                                    ${getIconSVG('Target', 16)}
                                    <span>${apostasFiltradas.length} apostas</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    ${getIconSVG('CheckCircle', 16)}
                                    <span>${formatCurrency(totalPagoFiltradas)} pago</span>
                                </div>
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;

            // Render Content
            let contentHtml = `<div class="p-4 pb-24">`;

            if (activeTab === 'home') {
                contentHtml += `
                    <div class="mb-6">
                        <div class="flex gap-2 overflow-x-auto pb-2">
                            ${[
                                { key: 'hoje', label: 'Hoje' },
                                { key: 'ontem', label: 'Ontem' },
                                { key: 'semana', label: 'Semana' },
                                { key: 'mes', label: 'Mês' },
                                { key: 'pendentes', label: 'Pendentes' },
                                { key: 'pagas', label: 'Pagas' },
                                { key: 'todos', label: 'Todos' }
                            ].map(filtro => `
                                <button
                                    onclick="filtroData = '${filtro.key}'; renderApp();"
                                    class="px-4 py-2 rounded-xl font-medium transition-all duration-200 whitespace-nowrap ${
                                        filtroData === filtro.key
                                            ? 'bg-green-500 text-white shadow-lg'
                                            : 'bg-white text-gray-600 border border-gray-200'
                                    }"
                                >
                                    ${filtro.label}
                                </button>
                            `).join('')}
                        </div>
                    </div>

                    <div class="grid grid-cols-3 gap-3 mb-6">
                        <div class="bg-white rounded-2xl p-4 shadow-lg">
                            <div class="flex items-center gap-2 mb-2">
                                ${getIconSVG('Trophy', 16, 'text-blue-600')}
                                <span class="text-xs font-medium text-gray-600">Total</span>
                            </div>
                            <p class="text-lg font-bold text-gray-800">${formatCurrency(totalApostasFiltradas)}</p>
                        </div>
                        <div class="bg-white rounded-2xl p-4 shadow-lg">
                            <div class="flex items-center gap-2 mb-2">
                                ${getIconSVG('CheckCircle', 16, 'text-green-600')}
                                <span class="text-xs font-medium text-gray-600">Pago</span>
                            </div>
                            <p class="text-lg font-bold text-green-600">${formatCurrency(totalPagoFiltradas)}</p>
                        </div>
                        <div class="bg-white rounded-2xl p-4 shadow-lg">
                            <div class="flex items-center gap-2 mb-2">
                                ${getIconSVG('Clock', 16, 'text-orange-600')}
                                <span class="text-xs font-medium text-gray-600">Pendente</span>
                            </div>
                            <p class="text-lg font-bold text-orange-600">${formatCurrency(totalPendenteFiltradas)}</p>
                        </div>
                    </div>

                    <div class="mb-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-bold text-gray-800">Apostas</h3>
                            <button
                                onclick="showAddAposta = true; renderApp();"
                                class="bg-gradient-to-r from-green-500 to-emerald-600 text-white p-3 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105"
                            >
                                ${getIconSVG('Plus', 20)}
                            </button>
                        </div>

                        <div class="space-y-3">
                            ${apostasFiltradas.length === 0 ? `
                                <p class="text-center text-gray-500 py-8">Nenhuma aposta encontrada com o filtro selecionado.</p>
                            ` : apostasFiltradas.map(aposta => {
                                const valorRestante = aposta.valor - (aposta.valorPago || 0);
                                const percentualPago = (aposta.valor > 0) ? ((aposta.valorPago || 0) / aposta.valor) * 100 : 0;
                                
                                return `
                                    <div class="bg-white rounded-2xl p-4 shadow-lg border border-gray-100">
                                        <div class="flex items-center justify-between mb-3">
                                            <div>
                                                <h4 class="font-semibold text-gray-800">${aposta.nome}</h4>
                                                <p class="text-sm text-gray-500">Data: ${formatDate(aposta.data)}</p>
                                                ${aposta.dataPagamento ? `<p class="text-xs text-green-600">Pago em: ${formatDate(aposta.dataPagamento)}</p>` : ''}
                                            </div>
                                            <div class="text-right">
                                                <p class="font-bold text-gray-800">${formatCurrency(aposta.valor)}</p>
                                                ${aposta.valorPago > 0 ? `<p class="text-sm text-green-600">Pago: ${formatCurrency(aposta.valorPago)}</p>` : ''}
                                                ${valorRestante > 0 ? `<p class="text-sm text-orange-600">Restante: ${formatCurrency(valorRestante)}</p>` : ''}
                                            </div>
                                        </div>
                                        
                                        ${aposta.valorPago > 0 ? `
                                            <div class="mb-3">
                                                <div class="flex justify-between text-xs text-gray-500 mb-1">
                                                    <span>Progresso do Pagamento</span>
                                                    <span>${percentualPago.toFixed(0)}%</span>
                                                </div>
                                                <div class="w-full bg-gray-200 rounded-full h-2">
                                                    <div 
                                                        class="h-2 rounded-full bg-gradient-to-r from-green-400 to-green-600"
                                                        style="width: ${Math.min(percentualPago, 100)}%"
                                                    ></div>
                                                </div>
                                            </div>
                                        ` : ''}
                                        
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center gap-2">
                                                <span class="px-2 py-1 rounded-full text-xs font-medium text-white ${
                                                    aposta.paga ? 'bg-green-500' : 'bg-orange-500'
                                                }">
                                                    ${aposta.paga ? 'Pago' : 'Pendente'}
                                                </span>
                                            </div>
                                            <div class="flex gap-2">
                                                ${!aposta.paga ? `
                                                    <button
                                                        onclick="pagamentoAposta = { valor: ${valorRestante.toFixed(2)}, tipo: 'parcial' }; showPagamentoAposta = ${aposta.id}; renderApp();"
                                                        class="px-3 py-1 bg-blue-100 text-blue-700 rounded-lg text-xs font-medium hover:bg-blue-200 transition-colors"
                                                    >
                                                        Pagamento
                                                    </button>
                                                    <button
                                                        onclick="marcarComoPaga(${aposta.id})"
                                                        class="px-3 py-1 bg-green-100 text-green-700 rounded-lg text-xs font-medium hover:bg-green-200 transition-colors"
                                                    >
                                                        Marcar Pago
                                                    </button>
                                                ` : ''}
                                                <button
                                                    onclick="showConfirmDeleteBet = ${aposta.id}; renderApp();"
                                                    class="p-1 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors"
                                                    title="Excluir Aposta"
                                                >
                                                    ${getIconSVG('Trash2', 16)}
                                                </button>
                                            </div>
                                        </div>

                                        ${aposta.pagamentos && aposta.pagamentos.length > 0 ? `
                                            <div class="mt-3 pt-3 border-t border-gray-100">
                                                <p class="text-xs font-medium text-gray-600 mb-2">Histórico de Pagamentos:</p>
                                                <div class="space-y-1">
                                                    ${aposta.pagamentos.map((pag, index) => `
                                                        <div class="flex justify-between text-xs text-gray-500">
                                                            <span>${formatDate(pag.data)}</span>
                                                            <span class="text-green-600 font-medium">${formatCurrency(pag.valor)}</span>
                                                        </div>
                                                    `).join('')}
                                                </div>
                                            </div>
                                        ` : ''}
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
            } else if (activeTab === 'analytics') {
                contentHtml += `
                    <div class="space-y-6">
                        <h3 class="text-lg font-bold text-gray-800 flex items-center gap-2">
                            ${getIconSVG('BarChart3', 20, 'text-green-600')}
                            Relatórios
                        </h3>
                        
                        <div class="grid grid-cols-1 gap-4">
                            <div class="bg-white rounded-2xl p-6 shadow-lg">
                                <h4 class="font-semibold text-gray-800 mb-4">Resumo Geral</h4>
                                <div class="space-y-4">
                                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded-xl">
                                        <span class="font-medium">Total de Apostas</span>
                                        <span class="font-bold">${apostas.length}</span>
                                    </div>
                                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded-xl">
                                        <span class="font-medium">Valor Total Apostado</span>
                                        <span class="font-bold">${formatCurrency(apostas.reduce((sum, a) => sum + a.valor, 0))}</span>
                                    </div>
                                    <div class="flex justify-between items-center p-3 bg-green-50 rounded-xl">
                                        <span class="font-medium text-green-700">Total Pago</span>
                                        <span class="font-bold text-green-700">${formatCurrency(apostas.reduce((sum, a) => sum + (a.valorPago || 0), 0))}</span>
                                    </div>
                                    <div class="flex justify-between items-center p-3 bg-orange-50 rounded-xl">
                                        <span class="font-medium text-orange-700">Total Pendente</span>
                                        <span class="font-bold text-orange-700">${formatCurrency(apostas.reduce((sum, a) => sum + (a.valor - (a.valorPago || 0)), 0))}</span>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-white rounded-2xl p-6 shadow-lg">
                                <h4 class="font-semibold text-gray-800 mb-4">Status dos Pagamentos</h4>
                                <div class="space-y-3">
                                    ${[
                                        { 
                                            key: 'pagas', 
                                            label: 'Apostas Pagas', 
                                            count: apostas.filter(a => a.paga).length,
                                            color: 'bg-green-500'
                                        },
                                        { 
                                            key: 'parciais', 
                                            label: 'Pagamentos Parciais', 
                                            count: apostas.filter(a => !a.paga && (a.valorPago || 0) > 0).length,
                                            color: 'bg-blue-500'
                                        },
                                        { 
                                            key: 'pendentes', 
                                            label: 'Totalmente Pendentes', 
                                            count: apostas.filter(a => !a.paga && (a.valorPago || 0) === 0).length,
                                            color: 'bg-orange-500'
                                        }
                                    ].map(status => {
                                        const percentage = apostas.length > 0 ? (status.count / apostas.length) * 100 : 0;
                                        return `
                                            <div class="space-y-2">
                                                <div class="flex justify-between items-center">
                                                    <div class="flex items-center gap-2">
                                                        <div class="w-3 h-3 rounded-full ${status.color}"></div>
                                                        <span class="text-sm font-medium">${status.label}</span>
                                                    </div>
                                                    <span class="text-sm font-bold">${status.count}</span>
                                                </div>
                                                <div class="w-full bg-gray-200 rounded-full h-2">
                                                    <div 
                                                        class="h-2 rounded-full ${status.color}"
                                                        style="width: ${percentage}%"
                                                    ></div>
                                                </div>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (activeTab === 'clientes') {
                if (clienteSelecionado) {
                    contentHtml += `
                        <div class="bg-white rounded-2xl p-6 shadow-lg">
                            <div class="flex items-center justify-between mb-4">
                                <button 
                                    onclick="clienteSelecionado = null; renderApp();"
                                    class="p-2 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors"
                                >
                                    ←
                                </button>
                                <h3 class="text-xl font-bold text-gray-800">${clienteSelecionado.nome}</h3>
                                <button
                                    onclick="showConfirmDeleteClient = '${clienteSelecionado.id}'; renderApp();"
                                    class="p-2 bg-red-100 text-red-700 rounded-full hover:bg-red-200 transition-colors"
                                    title="Excluir Cliente e suas Apostas"
                                >
                                    ${getIconSVG('Trash2', 20)}
                                </button>
                            </div>

                            <div class="space-y-4 mb-6">
                                <div class="p-3 bg-gray-50 rounded-xl">
                                    <p class="text-sm text-gray-600">Total de Apostas: <span class="font-bold">${apostas.filter(a => a.clienteId === clienteSelecionado.id).length}</span></p>
                                </div>
                                <div class="p-3 bg-orange-50 rounded-xl">
                                    <p class="text-sm text-orange-700">Dívida Pendente: <span class="font-bold">${formatCurrency(getDividaPendenteCliente(clienteSelecionado.id))}</span></p>
                                </div>
                            </div>

                            <div class="flex gap-3 mb-6">
                                <button
                                    onclick="pagamentoCliente = { valor: ${getDividaPendenteCliente(clienteSelecionado.id).toFixed(2)}, tipo: 'total' }; showPagamentoCliente = '${clienteSelecionado.id}'; renderApp();"
                                    class="flex-1 bg-green-500 text-white p-3 rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all duration-300"
                                >
                                    Pagar Toda Dívida
                                </button>
                                <button
                                    onclick="pagamentoCliente = { valor: '', tipo: 'parcial' }; showPagamentoCliente = '${clienteSelecionado.id}'; renderApp();"
                                    class="flex-1 bg-blue-500 text-white p-3 rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all duration-300"
                                >
                                    Pagamento Parcial
                                </button>
                            </div>

                            <h4 class="font-semibold text-gray-800 mb-4">Histórico de Apostas</h4>
                            <div class="space-y-3">
                                ${apostas.filter(a => a.clienteId === clienteSelecionado.id).length === 0 ? `
                                    <p class="text-center text-gray-500 py-4">Nenhuma aposta para este cliente.</p>
                                ` : apostas.filter(a => a.clienteId === clienteSelecionado.id).sort((a, b) => new Date(b.data) - new Date(a.data)).map(aposta => {
                                    const valorRestante = aposta.valor - (aposta.valorPago || 0);
                                    return `
                                        <div class="bg-gray-50 rounded-xl p-4 border border-gray-100">
                                            <div class="flex justify-between items-center mb-2">
                                                <p class="font-medium text-gray-800">Aposta em ${formatDate(aposta.data)}</p>
                                                <div class="flex gap-2 items-center">
                                                    <span class="px-2 py-1 rounded-full text-xs font-medium text-white ${
                                                        aposta.paga ? 'bg-green-500' : 'bg-orange-500'
                                                    }">
                                                        ${aposta.paga ? 'Pago' : 'Pendente'}
                                                    </span>
                                                    ${!aposta.paga ? `
                                                        <button
                                                            onclick="pagamentoAposta = { valor: ${valorRestante.toFixed(2)}, tipo: 'parcial' }; showPagamentoAposta = ${aposta.id}; renderApp();"
                                                            class="p-1 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors"
                                                            title="Registrar Pagamento"
                                                        >
                                                            ${getIconSVG('DollarSign', 16)}
                                                        </button>
                                                    ` : ''}
                                                    <button
                                                        onclick="handleEditAposta(${JSON.stringify(aposta).replace(/"/g, '&quot;')})"
                                                        class="p-1 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors"
                                                        title="Editar Aposta"
                                                    >
                                                        ${getIconSVG('Edit3', 16)}
                                                    </button>
                                                </div>
                                            </div>
                                            <p class="text-sm text-gray-600">Valor: ${formatCurrency(aposta.valor)}</p>
                                            ${aposta.valorPago > 0 ? `<p class="text-sm text-green-600">Pago: ${formatCurrency(aposta.valorPago)}</p>` : ''}
                                            ${valorRestante > 0 ? `<p class="text-sm text-orange-600">Restante: ${formatCurrency(valorRestante)}</p>` : ''}
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    `;
                } else {
                    contentHtml += `
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-bold text-gray-800">Meus Clientes</h3>
                            <button
                                onclick="showAddCliente = true; renderApp();"
                                class="bg-gradient-to-r from-green-500 to-emerald-600 text-white p-3 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105"
                            >
                                ${getIconSVG('Plus', 20)}
                            </button>
                        </div>

                        <div class="space-y-3">
                            ${sortedClientes.length === 0 ? `
                                <p class="text-center text-gray-500 py-8">Nenhum cliente cadastrado.</p>
                            ` : sortedClientes.map(cliente => {
                                const dividaPendente = getDividaPendenteCliente(cliente.id);
                                return `
                                <div 
                                    class="bg-white rounded-2xl p-4 shadow-lg border border-gray-100 flex items-center justify-between"
                                >
                                    <div 
                                        class="flex-1 flex items-center gap-2 cursor-pointer"
                                        onclick="clienteSelecionado = ${JSON.stringify(cliente).replace(/"/g, '&quot;')}; renderApp();"
                                    >
                                        ${cliente.favorito ? getIconSVG('Star', 18, 'text-yellow-500 fill-yellow-500') : ''}
                                        <span class="font-semibold text-gray-800">${cliente.nome}</span>
                                        ${dividaPendente > 0 ? `<span class="ml-2 text-sm font-bold text-orange-600">${formatCurrency(dividaPendente)}</span>` : ''}
                                    </div>
                                    <button
                                        onclick="toggleFavoritoCliente('${cliente.id}');"
                                        class="p-2 rounded-full transition-colors ${
                                            cliente.favorito ? 'bg-yellow-100 text-yellow-600 hover:bg-yellow-200' : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                                        }"
                                        title="${cliente.favorito ? "Desfavoritar" : "Favoritar"}"
                                    >
                                        ${getIconSVG('Star', 18)}
                                    </button>
                                </div>
                            `;
                            }).join('')}
                        </div>
                    `;
                }
            } else if (activeTab === 'config') {
                contentHtml += `
                    <div class="space-y-6">
                        <h3 class="text-lg font-bold text-gray-800 flex items-center gap-2">
                            ${getIconSVG('Settings', 20, 'text-gray-600')}
                            Configurações
                        </h3>
                        <div class="bg-white rounded-2xl p-6 shadow-lg">
                            <p class="text-gray-700">Aqui você pode gerenciar as configurações do aplicativo.</p>
                            <p class="text-sm text-gray-500 mt-2">Versão do aplicativo: ${apostas.length > 0 && apostas[0].versao ? apostas[0].versao : '5.0'}</p>
                        </div>
                    </div>
                `;
            }

            contentHtml += `</div>`; // Fecha div.p-4.pb-24
            appRoot.innerHTML += contentHtml;

            // Render Modals
            if (showAddAposta) {
                appRoot.innerHTML += `
                    <div class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end justify-center z-50 p-4">
                        <div class="bg-white rounded-t-3xl p-6 w-full max-w-md">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="text-xl font-bold text-gray-800">Nova Aposta</h3>
                                <button 
                                    onclick="showAddAposta = false; renderApp();"
                                    class="p-2 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors"
                                >
                                    ✕
                                </button>
                            </div>

                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Cliente</label>
                                    ${clientes.length > 0 ? `
                                        <select
                                            id="novaApostaClienteId"
                                            onchange="novaAposta.clienteId = this.value; renderApp();"
                                            class="w-full p-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-green-500 focus:border-transparent outline-none"
                                        >
                                            <option value="">Selecione um cliente</option>
                                            ${sortedClientes.map(cliente => `
                                                <option value="${cliente.id}" ${novaAposta.clienteId === cliente.id ? 'selected' : ''}>${cliente.nome}</option>
                                            `).join('')}
                                        </select>
                                    ` : `
                                        <p class="text-sm text-gray-500">Nenhum cliente cadastrado. Adicione um na aba "Clientes".</p>
                                    `}
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Valor Apostado (R$)</label>
                                    <input
                                        type="number"
                                        step="0.01"
                                        value="${novaAposta.valor}"
                                        onchange="novaAposta.valor = this.value; renderApp();"
                                        class="w-full p-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-green-500 focus:border-transparent outline-none"
                                        placeholder="100.00"
                                    />
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Data da Aposta</label>
                                    <input
                                        type="date"
                                        value="${novaAposta.data}"
                                        onchange="novaAposta.data = this.value; renderApp();"
                                        class="w-full p-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-green-500 focus:border-transparent outline-none"
                                    />
                                </div>

                                <button
                                    onclick="adicionarAposta();"
                                    class="w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white p-4 rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all duration-300"
                                    ${!novaAposta.clienteId || !novaAposta.valor ? 'disabled' : ''}
                                >
                                    Registrar Aposta
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }

            if (showEditAposta && apostaEmEdicao) {
                appRoot.innerHTML += `
                    <div class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end justify-center z-50 p-4">
                        <div class="bg-white rounded-t-3xl p-6 w-full max-w-md">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="text-xl font-bold text-gray-800">Editar Aposta</h3>
                                <button 
                                    onclick="showEditAposta = false; apostaEmEdicao = null; renderApp();"
                                    class="p-2 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors"
                                >
                                    ✕
                                </button>
                            </div>

                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Cliente</label>
                                    ${clientes.length > 0 ? `
                                        <select
                                            value="${apostaEmEdicao.clienteId}"
                                            onchange="apostaEmEdicao.clienteId = this.value; renderApp();"
                                            class="w-full p-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-green-500 focus:border-transparent outline-none"
                                        >
                                            ${sortedClientes.map(cliente => `
                                                <option value="${cliente.id}" ${apostaEmEdicao.clienteId === cliente.id ? 'selected' : ''}>${cliente.nome}</option>
                                            `).join('')}
                                        </select>
                                    ` : `
                                        <p class="text-sm text-gray-500">Nenhum cliente cadastrado.</p>
                                    `}
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Valor Apostado (R$)</label>
                                    <input
                                        type="number"
                                        step="0.01"
                                        value="${apostaEmEdicao.valor}"
                                        onchange="apostaEmEdicao.valor = this.value; renderApp();"
                                        class="w-full p-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-green-500 focus:border-transparent outline-none"
                                        placeholder="100.00"
                                    />
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Data da Aposta</label>
                                    <input
                                        type="date"
                                        value="${apostaEmEdicao.data}"
                                        onchange="apostaEmEdicao.data = this.value; renderApp();"
                                        class="w-full p-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-green-500 focus:border-transparent outline-none"
                                    />
                                </div>

                                <button
                                    onclick="updateAposta();"
                                    class="w-full bg-gradient-to-r from-blue-500 to-indigo-600 text-white p-4 rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all duration-300"
                                    ${!apostaEmEdicao.clienteId || !apostaEmEdicao.valor ? 'disabled' : ''}
                                >
                                    Salvar Alterações
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }

            if (showPagamentoAposta) {
                appRoot.innerHTML += `
                    <div class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end justify-center z-50 p-4">
                        <div class="bg-white rounded-t-3xl p-6 w-full max-w-md">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="text-xl font-bold text-gray-800">Registrar Pagamento (Aposta)</h3>
                                <button 
                                    onclick="showPagamentoAposta = null; renderApp();"
                                    class="p-2 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors"
                                >
                                    ✕
                                </button>
                            </div>

                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Valor do Pagamento (R$)</label>
                                    <input
                                        type="number"
                                        step="0.01"
                                        value="${pagamentoAposta.valor}"
                                        onchange="pagamentoAposta.valor = this.value; renderApp();"
                                        class="w-full p-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-green-500 focus:border-transparent outline-none"
                                        placeholder="50.00"
                                    />
                                </div>

                                <button
                                    onclick="adicionarPagamentoParcialAposta();"
                                    class="w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white p-4 rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all duration-300"
                                >
                                    Registrar Pagamento
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }

            if (showPagamentoCliente) {
                appRoot.innerHTML += `
                    <div class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end justify-center z-50 p-4">
                        <div class="bg-white rounded-t-3xl p-6 w-full max-w-md">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="text-xl font-bold text-gray-800">Registrar Pagamento (Cliente)</h3>
                                <button 
                                    onclick="showPagamentoCliente = null; renderApp();"
                                    class="p-2 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors"
                                >
                                    ✕
                                </button>
                            </div>

                            <div class="space-y-4">
                                <p class="text-sm text-gray-600">
                                    Cliente: <span class="font-semibold">${getClienteById(showPagamentoCliente)?.nome}</span>
                                </p>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Valor do Pagamento (R$)</label>
                                    <input
                                        type="number"
                                        step="0.01"
                                        value="${pagamentoCliente.valor}"
                                        onchange="pagamentoCliente.valor = this.value; renderApp();"
                                        class="w-full p-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-green-500 focus:border-transparent outline-none"
                                        placeholder="50.00"
                                    />
                                </div>

                                <div class="flex gap-3">
                                    <button
                                        onclick="adicionarPagamentoCliente();"
                                        class="flex-1 bg-gradient-to-r from-blue-500 to-blue-600 text-white p-4 rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all duration-300"
                                    >
                                        Registrar Parcial
                                    </button>
                                    <button
                                        onclick="pagarDividaTotalCliente();"
                                        class="flex-1 bg-gradient-to-r from-green-500 to-emerald-600 text-white p-4 rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all duration-300"
                                    >
                                        Pagar Tudo
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            if (showAddCliente) {
                appRoot.innerHTML += `
                    <div class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-end justify-center z-50 p-4">
                        <div class="bg-white rounded-t-3xl p-6 w-full max-w-md">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="text-xl font-bold text-gray-800">Novo Cliente</h3>
                                <button 
                                    onclick="showAddCliente = false; renderApp();"
                                    class="p-2 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors"
                                >
                                    ✕
                                </button>
                            </div>

                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Nome do Cliente</label>
                                    <input
                                        type="text"
                                        value="${novoClienteNome}"
                                        onchange="novoClienteNome = this.value; renderApp();"
                                        class="w-full p-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-green-500 focus:border-transparent outline-none"
                                        placeholder="Ex: Maria Souza"
                                    />
                                </div>

                                <button
                                    onclick="adicionarCliente();"
                                    class="w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white p-4 rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all duration-300"
                                    ${!novoClienteNome.trim() ? 'disabled' : ''}
                                >
                                    Adicionar Cliente
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }

            if (showConfirmDeleteBet) {
                appRoot.innerHTML += ConfirmationModal(
                    "Tem certeza que deseja excluir esta aposta?",
                    `handleDeleteBet(${showConfirmDeleteBet})`,
                    `showConfirmDeleteBet = null; renderApp();`
                );
            }

            if (showConfirmDeleteClient) {
                appRoot.innerHTML += ConfirmationModal(
                    "Tem certeza que deseja excluir este cliente e todas as suas apostas?",
                    `handleDeleteClient('${showConfirmDeleteClient}')`,
                    `showConfirmDeleteClient = null; renderApp();`
                );
            }

            // Render Bottom Navigation
            appRoot.innerHTML += `
                <div class="fixed bottom-0 left-0 right-0 bg-white/80 backdrop-blur-lg border-t border-gray-200 p-4">
                    <div class="flex justify-around max-w-md mx-auto">
                        ${NavButton('home', 'Home', 'Apostas', activeTab === 'home')}
                        ${NavButton('analytics', 'PieChart', 'Relatórios', activeTab === 'analytics')}
                        ${NavButton('clientes', 'User', 'Clientes', activeTab === 'clientes')}
                        ${NavButton('config', 'Settings', 'Config', activeTab === 'config')}
                    </div>
                </div>
            `;

            // Adicionar event listeners para os botões de navegação após a renderização
            appRoot.querySelectorAll('[data-tab]').forEach(button => {
                button.onclick = () => {
                    activeTab = button.dataset.tab;
                    clienteSelecionado = null; // Resetar cliente selecionado ao mudar de aba
                    renderApp();
                };
            });
        }

        // --- Inicialização ---
        window.onload = () => {
            carregarDados();
            renderApp();
        };
    </script>
</body>
</html>
